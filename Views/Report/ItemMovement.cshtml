@model Inventory_Management_System.ViewModels.ItemMovementReportViewModel

@{
    ViewData["Title"] = "Item Movement Report";
}

<style>
    .select2-container--bootstrap4 .select2-selection--multiple {
        
        border: 1px solid #ced4da;
    }

        .select2-container--bootstrap4 .select2-selection--multiple .select2-selection__choice {
            background-color: #6f42c1;
            border: 1px solid #6610f2;
          
            padding: 3px 8px;
            margin: 2px;
            border-radius: 4px;
        }

        .select2-container--bootstrap4 .select2-selection--multiple .select2-selection__clear {
            color: #6f42c1;
            font-weight: bold;
            margin-left: 5px;
            margin-right: 5px;
            font-size: 18px;
        }

            .select2-container--bootstrap4 .select2-selection--multiple .select2-selection__clear:hover {
                color: #dc3545;
            }

    .select2-container--bootstrap4 .select2-dropdown {
        border-color: #6f42c1;
    }

    .select2-container--bootstrap4 .select2-results__option--highlighted[aria-selected] {
        background-color: #6f42c1 !important;
        color: #fff;
    }

    .select2-container--bootstrap4 .select2-search--dropdown .select2-search__field {
        border: 1px solid #6f42c1;
    }

    .select2-container--bootstrap4.select2-container--focus .select2-selection {
        border-color: #6f42c1;
    }
</style>

<div class="container">
    <h2 class="text-center mb-4">@ViewData["Title"]</h2>

    <div class="card">
        <div class="card-body">
            <form asp-action="ItemMovement" method="post">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="StartDate" class="control-label"></label>
                            <input asp-for="StartDate" class="form-control" />
                            <span asp-validation-for="StartDate" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="EndDate" class="control-label"></label>
                            <input asp-for="EndDate" class="form-control" />
                            <span asp-validation-for="EndDate" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label asp-for="SelectedWarehouseIds" class="control-label"></label>
                            <select asp-for="SelectedWarehouseIds" class="form-control select2" multiple>
                                <option></option>
                                @foreach (var warehouse in Model.AvailableWarehouses)
                                {
                                    <option value="@warehouse.Id">@warehouse.Name</option>
                                }
                            </select>
                            <small class="form-text text-muted">Leave blank to show all warehouses</small>
                        </div>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <button type="submit" class="btn btn-primary">Show Report</button>
                    
                        <a asp-action="Index" asp-controller="Home" class="btn btn-secondary ms-2">Back to Home</a>
                  
                </div>
            </form>
        </div>
    </div>

    @if (Model.Results != null && Model.Results.Any())
    {
        <div class="card mt-4">
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead>
                            <tr>
                                <th>Item Code</th>
                                <th>Item Name</th>
                                <th>Warehouse</th>
                                <th>Initial Quantity</th>
                                <th>Incoming</th>
                                <th>Outgoing</th>
                                <th>Final Quantity</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.Results)
                            {
                                <tr>
                                    <td>@item.ItemCode</td>
                                    <td>@item.ItemName</td>
                                    <td>@item.WarehouseName</td>
                                    <td>@item.InitialQuantity</td>
                                    <td>@item.IncomingQuantity</td>
                                    <td>@item.OutgoingQuantity</td>
                                    <td>@item.FinalQuantity</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.select2').select2({
                theme: 'bootstrap4',
                allowClear: true,
                placeholder: {
                    id: '',
                    text: 'Select Warehouses'
                },
                dir: "ltr", // Changed to ltr for English
                language: {
                    noResults: function() {
                        return "No results found";
                    }
                },
                width: '100%',
                templateResult: formatState,
                templateSelection: formatState
            });

            function formatState(state) {
                if (!state.id) {
                    return state.text;
                }
                return $('<span style="padding: 3px;">' + state.text + '</span>');
            }
        });
    </script>
}